<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GateDog314 Swap</title>
    <link rel="icon" type="image/png" href="./dog.png">
    <link rel="shortcut icon" type="image/png" href="./dog.png">
    <link rel="apple-touch-icon" href="./dog.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #2563eb;
            --light-blue: #3b82f6;
            --deep-blue: #1e40af;
            --sky-blue: #0ea5e9;
            --ice-blue: #e0f2fe;
            --pure-white: #ffffff;
            --soft-white: #f8fafc;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(-45deg, #2563eb, #3b82f6, #0ea5e9, #1e40af);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            /* ÂÖÅËÆ∏Ê≠£Â∏∏ÊªöÂä®Ôºå‰∏çÈôêÂà∂È´òÂ∫¶ */
            height: auto;
            /* Á°Æ‰øùÊ≠£Â∏∏ÁöÑÊªöÂä®Ë°å‰∏∫ */
            overscroll-behavior: auto;
            touch-action: pan-y;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 120%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.08' d='M0,64L24,74.7C48,85,96,107,144,112C192,117,240,107,288,112C336,117,384,139,432,133.3C480,128,528,96,576,96C624,96,672,128,720,149.3C768,171,816,181,864,165.3C912,149,960,107,1008,101.3C1056,96,1104,128,1152,149.3C1200,171,1248,181,1296,165.3C1344,149,1392,107,1416,85.3L1440,64L1440,320L1416,320C1392,320,1344,320,1296,320C1248,320,1200,320,1152,320C1104,320,1056,320,1008,320C960,320,912,320,864,320C816,320,768,320,720,320C672,320,624,320,576,320C528,320,480,320,432,320C384,320,336,320,288,320C240,320,192,320,144,320C96,320,48,320,24,320L0,320Z'%3E%3C/path%3E%3C/svg%3E") repeat-x;
            animation: waveFlow 25s linear infinite;
            z-index: 0;
        }

        body::after {
            content: '';
            position: absolute;
            top: 100px;
            left: 0;
            width: 120%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.05' d='M0,192L24,197.3C48,203,96,213,144,202.7C192,192,240,160,288,165.3C336,171,384,213,432,218.7C480,224,528,192,576,165.3C624,139,672,117,720,133.3C768,149,816,203,864,208C912,213,960,171,1008,149.3C1056,128,1104,128,1152,144C1200,160,1248,192,1296,197.3C1344,203,1392,181,1416,170.7L1440,160L1440,320L1416,320C1392,320,1344,320,1296,320C1248,320,1200,320,1152,320C1104,320,1056,320,1008,320C960,320,912,320,864,320C816,320,768,320,720,320C672,320,624,320,576,320C528,320,480,320,432,320C384,320,336,320,288,320C240,320,192,320,144,320C96,320,48,320,24,320L0,320Z'%3E%3C/path%3E%3C/svg%3E") repeat-x;
            animation: waveFlow 20s linear infinite reverse;
            z-index: 0;
        }

        @keyframes waveFlow {
            0% { transform: translateX(0); }
            100% { transform: translateX(-200px); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            color: white;
            z-index: 10;
            position: relative;
        }

        .title {
            font-family: 'Poppins', sans-serif;
            font-size: 3.8rem;
            font-weight: 900;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .title::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), rgba(59, 130, 246, 0.3), transparent);
            animation: shimmer 3s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: -100%; }
        }

        .dog-icon {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dog-icon-fallback {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 25px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .percentage-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end;
        }

        .percentage-btn {
            background: linear-gradient(135deg, var(--primary-blue), var(--sky-blue));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
            position: relative;
            overflow: hidden;
        }

        .percentage-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .percentage-btn:hover::before {
            width: 100px;
            height: 100px;
        }

        .percentage-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .percentage-btn:active {
            transform: translateY(0);
        }

        .container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 45px;
            box-shadow: 
                0 30px 100px rgba(0, 0, 0, 0.12),
                0 0 0 1px rgba(255, 255, 255, 0.5),
                inset 0 1px 3px rgba(255, 255, 255, 0.5);
            width: 100%;
            max-width: 520px;
            position: relative;
            z-index: 10;
            animation: containerFloat 6s ease-in-out infinite;
        }

        @keyframes containerFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .token-input {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border: 2px solid rgba(37, 99, 235, 0.08);
            border-radius: 24px;
            padding: 28px;
            margin-bottom: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .token-input::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-blue), transparent);
            transition: left 0.5s ease;
        }

        .token-input:focus-within::before {
            left: 100%;
        }

        .token-input:focus-within {
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 
                0 20px 40px rgba(37, 99, 235, 0.15),
                0 0 0 4px rgba(37, 99, 235, 0.05);
        }

        .token-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .token-select {
            display: flex;
            align-items: center;
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border: 2px solid rgba(37, 99, 235, 0.08);
            border-radius: 16px;
            padding: 12px 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
        }

        .token-select:hover {
            border-color: var(--primary-blue);
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        .token-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .gt-icon {
            background: linear-gradient(135deg, var(--primary-blue), var(--sky-blue));
        }

        .gdog-icon {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
        }

        .token-icon img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .amount-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 32px;
            font-weight: 600;
            color: var(--text-dark);
            outline: none;
            font-family: 'Poppins', sans-serif;
        }

        .amount-input::placeholder {
            color: #cbd5e1;
            font-weight: 300;
        }

        .balance {
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .balance-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        .swap-button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 25px 0;
            gap: 12px;
        }

        .swap-direction-indicator {
            text-align: center;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.5px;
        }

        .buy-indicator {
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            animation: buyPulse 2s ease-in-out infinite;
        }

        .sell-indicator {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
            animation: sellPulse 2s ease-in-out infinite;
        }

        @keyframes buyPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5); }
            70% { box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }

        @keyframes sellPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.5); }
            70% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
        }

        .swap-icon {
            background: linear-gradient(135deg, var(--primary-blue), var(--sky-blue));
            color: white;
            border: none;
            border-radius: 50%;
            width: 65px;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 10px 30px rgba(37, 99, 235, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
            font-size: 26px;
        }

        .swap-icon:hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 15px 40px rgba(37, 99, 235, 0.4);
        }

        .pool-info {
            background: linear-gradient(145deg, rgba(37, 99, 235, 0.08), rgba(255, 255, 255, 0.9));
            border-radius: 18px;
            padding: 18px;
            margin-bottom: 20px;
            border: 1px solid rgba(37, 99, 235, 0.15);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .pool-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
            color: var(--text-dark);
            padding: 4px 0;
        }

        .pool-row:last-child {
            margin-bottom: 0;
            padding-top: 10px;
            border-top: 1px solid rgba(37, 99, 235, 0.1);
            font-weight: 600;
        }

        .pool-row span:last-child {
            font-weight: 600;
            color: var(--primary-blue);
        }

        .price-info {
            background: linear-gradient(145deg, var(--ice-blue), #ffffff);
            border-radius: 18px;
            padding: 22px;
            margin-bottom: 25px;
            border: 1px solid rgba(37, 99, 235, 0.08);
            box-shadow: 0 2px 10px rgba(37, 99, 235, 0.08);
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
            color: var(--text-dark);
        }

        .price-row:last-child {
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid rgba(37, 99, 235, 0.1);
            font-weight: 600;
            font-size: 16px;
        }

        .price-row span:last-child {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .wallet-selector {
            display: none;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.99), rgba(248, 250, 252, 0.98));
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 35px;
            margin-top: 20px;
            box-shadow: 
                0 25px 70px rgba(0, 0, 0, 0.12),
                0 0 0 1px rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wallet-selector.show {
            display: block;
        }

        .wallet-title {
            text-align: center;
            color: var(--text-dark);
            font-weight: 700;
            margin-bottom: 28px;
            font-size: 22px;
        }

        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .wallet-option {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 2px solid rgba(37, 99, 235, 0.08);
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            position: relative;
            overflow: hidden;
        }

        .wallet-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .wallet-option:hover::before {
            left: 100%;
        }

        .wallet-option:hover {
            border-color: var(--primary-blue);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.15);
        }

        .wallet-icon {
            width: 38px;
            height: 38px;
            margin-right: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .wallet-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
            background: white;
        }

        .wallet-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 15px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .connect-wallet, .swap-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-blue), var(--sky-blue));
            color: white;
            border: none;
            border-radius: 18px;
            padding: 22px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 10px 30px rgba(37, 99, 235, 0.25),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .connect-wallet::before, .swap-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .connect-wallet:hover::before, .swap-btn:hover::before {
            width: 400px;
            height: 400px;
        }

        .connect-wallet:hover, .swap-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(37, 99, 235, 0.3);
        }

        .swap-btn:disabled {
            background: linear-gradient(135deg, #94a3b8, #cbd5e1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .swap-btn:disabled::before {
            display: none;
        }

        .close-wallets {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 14px 22px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .close-wallets:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
        }

        .network-info {
            background: linear-gradient(145deg, rgba(37, 99, 235, 0.06), rgba(255, 255, 255, 0.9));
            border: 1px solid rgba(37, 99, 235, 0.15);
            border-radius: 18px;
            padding: 22px;
            margin-top: 25px;
            text-align: center;
            color: var(--deep-blue);
            font-size: 14px;
            font-weight: 500;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            word-break: break-all;
            line-height: 1.5;
        }


        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error, .success {
            border-radius: 14px;
            padding: 18px;
            margin-top: 20px;
            font-size: 14px;
            font-weight: 500;
            animation: messageSlide 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .error {
            background: linear-gradient(145deg, #fee2e2, #fecaca);
            border: 1px solid #f87171;
            color: #dc2626;
        }

        .success {
            background: linear-gradient(145deg, #d1fae5, #a7f3d0);
            border: 1px solid #34d399;
            color: #065f46;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @media (max-width: 768px) {
            .title { 
                font-size: 2.5rem; 
                gap: 15px;
            }
            .container { 
                padding: 20px; 
                margin: 10px;
                max-width: calc(100vw - 20px);
            }
            .wallet-grid { 
                grid-template-columns: 1fr; 
            }
            .token-input {
                padding: 20px;
                margin-bottom: 15px;
            }
            .amount-input {
                font-size: 24px;
            }
            .pool-info, .price-info, .network-info {
                padding: 15px;
                margin-bottom: 15px;
                font-size: 12px;
            }
            .pool-row, .price-row {
                font-size: 12px;
                margin-bottom: 8px;
            }
            .network-info {
                font-size: 11px;
                line-height: 1.4;
                word-break: break-all;
            }
            .action-buttons {
                gap: 12px;
            }
            .connect-wallet, .swap-btn {
                padding: 18px;
                font-size: 16px;
            }
            .wallet-selector {
                padding: 25px;
                margin: 10px;
                max-width: calc(100vw - 20px);
            }
            .wallet-option {
                padding: 15px;
            }
            .wallet-icon {
                width: 32px;
                height: 32px;
                margin-right: 12px;
                font-size: 14px;
            }
            .wallet-icon img {
                border-radius: 8px;
                object-fit: contain;
                background: white;
            }
            .wallet-name {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .title { 
                font-size: 2rem; 
                gap: 10px;
                flex-direction: column;
                text-align: center;
            }
            .container { 
                padding: 15px; 
                margin: 5px;
                max-width: calc(100vw - 10px);
                border-radius: 20px;
            }
            .token-input {
                padding: 15px;
                border-radius: 18px;
            }
            .amount-input {
                font-size: 20px;
            }
            .pool-info, .price-info, .network-info {
                padding: 12px;
                border-radius: 12px;
                font-size: 11px;
            }
            .pool-row, .price-row {
                font-size: 11px;
                margin-bottom: 6px;
            }
            .network-info {
                font-size: 10px;
                line-height: 1.3;
            }
            .connect-wallet, .swap-btn {
                padding: 16px;
                font-size: 15px;
                border-radius: 14px;
            }
            .wallet-selector {
                padding: 20px;
                margin: 5px;
                max-width: calc(100vw - 10px);
                border-radius: 20px;
            }
            .wallet-option {
                padding: 12px;
                border-radius: 12px;
            }
            .percentage-btn {
                padding: 6px 10px;
                font-size: 11px;
            }
            .swap-icon {
                width: 55px;
                height: 55px;
                font-size: 22px;
            }
            .dog-icon, .dog-icon-fallback {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }

        @media (max-width: 360px) {
            .title { 
                font-size: 1.8rem; 
            }
            .container { 
                padding: 12px; 
                margin: 3px;
                max-width: calc(100vw - 6px);
            }
            .token-input {
                padding: 12px;
            }
            .amount-input {
                font-size: 18px;
            }
            .pool-info, .price-info, .network-info {
                padding: 10px;
                font-size: 10px;
            }
            .pool-row, .price-row {
                font-size: 10px;
                margin-bottom: 5px;
            }
            .network-info {
                font-size: 9px;
                line-height: 1.2;
            }
            .connect-wallet, .swap-btn {
                padding: 14px;
                font-size: 14px;
            }
            .wallet-selector {
                padding: 15px;
                margin: 3px;
                max-width: calc(100vw - 6px);
            }
            .wallet-option {
                padding: 10px;
            }
            .percentage-btn {
                padding: 5px 8px;
                font-size: 10px;
            }
            .swap-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            .dog-icon, .dog-icon-fallback {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">
            <img src="./dog.png" class="dog-icon" alt="Dog" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
            <div class="dog-icon-fallback" style="display:none;">üêï</div>
            GateDog314 Swap
        </h1>
    </div>

    <div class="container">
        <div class="swap-container">
            <div class="token-input" id="fromTokenInput">
                <div class="token-header">
                    <div class="token-select" id="fromTokenSelect">
                        <div class="token-icon gt-icon">
                            <img src="./gt-logo.png" alt="GT" onerror="this.style.display='none'; this.parentElement.innerHTML='GT';" />
                        </div>
                        <span>GT</span>
                    </div>
                    <div class="balance">Balance: <span class="balance-value" id="fromBalance">0.0000</span></div>
                </div>
                <input type="number" class="amount-input" id="fromAmount" placeholder="0.0" oninput="calculateOutput()" />
                <div class="percentage-buttons">
                    <button class="percentage-btn" onclick="setPercentage(25)">25%</button>
                    <button class="percentage-btn" onclick="setPercentage(50)">50%</button>
                    <button class="percentage-btn" onclick="setPercentage(100)">100%</button>
                </div>
            </div>

            <div class="swap-button-container">
                <div class="swap-direction-indicator buy-indicator" id="swapIndicator">
                    <span id="swapDirectionText">üü¢ Buy GDOG314 with GT</span>
                </div>
                <button class="swap-icon" onclick="swapTokens()">‚áÖ</button>
            </div>

            <div class="token-input" id="toTokenInput">
                <div class="token-header">
                    <div class="token-select" id="toTokenSelect">
                        <div class="token-icon gdog-icon">
                            <img src="./dog.png" alt="GDOG314" onerror="this.style.display='none'; this.parentElement.innerHTML='GDOG';" />
                        </div>
                        <span>GDOG314</span>
                    </div>
                    <div class="balance">Balance: <span class="balance-value" id="toBalance">0.00</span></div>
                </div>
                <input type="number" class="amount-input" id="toAmount" placeholder="0.0" readonly />
            </div>
        </div>

        <div class="pool-info" id="poolInfo">
            <div class="pool-row">
                <span>Pool GT Balance:</span>
                <span id="poolGtBalance">Loading...</span>
            </div>
            <div class="pool-row">
                <span>Pool GDOG314 Balance:</span>
                <span id="poolGdogBalance">Loading...</span>
            </div>
            <div class="pool-row">
                <span>Current GT Price:</span>
                <span id="currentGtPrice">$16.93</span>
            </div>
            <div class="pool-row">
                <span>GDOG314 Price:</span>
                <span id="currentGdogPrice">$0.000</span>
            </div>
        </div>

        <div class="price-info" id="priceInfo" style="display: none;">
            <div class="price-row">
                <span>Expected Price:</span>
                <span id="tokenPrice">$0.000</span>
            </div>
            <div class="price-row">
                <span>Slippage:</span>
                <span>0.5%</span>
            </div>
            <div class="price-row">
                <span>You will receive:</span>
                <span id="receiveAmount">0 GDOG314</span>
            </div>
        </div>

        <div class="action-buttons">
            <button class="connect-wallet" id="connectBtn" onclick="showWalletSelector()">Connect Wallet</button>
            <button class="swap-btn" id="swapBtn" onclick="executeSwap()" style="display: none;" disabled>Enter Amount</button>
        </div>

        <div class="wallet-selector" id="walletSelector">
            <div class="wallet-title">Choose Your Wallet</div>
            <div class="wallet-grid">
                <div class="wallet-option" onclick="connectSpecificWallet('tokenpocket')">
                    <div class="wallet-icon">
                        <img src="./tp.jpg" alt="TokenPocket" onerror="this.style.display='none'; this.parentElement.innerHTML='TP';" />
                    </div>
                    <div class="wallet-name">TokenPocket</div>
                </div>
                <div class="wallet-option" onclick="connectSpecificWallet('metamask')">
                    <div class="wallet-icon">
                        <img src="./metamask.jpg" alt="MetaMask" onerror="this.style.display='none'; this.parentElement.innerHTML='ü¶ä';" />
                    </div>
                    <div class="wallet-name">MetaMask</div>
                </div>
                <div class="wallet-option" onclick="connectSpecificWallet('okx')">
                    <div class="wallet-icon">
                        <img src="./okx.jpg" alt="OKX Wallet" onerror="this.style.display='none'; this.parentElement.innerHTML='OKX';" />
                    </div>
                    <div class="wallet-name">OKX Wallet</div>
                </div>
                <div class="wallet-option" onclick="connectSpecificWallet('gate')">
                    <div class="wallet-icon">
                        <img src="./gate.jpg" alt="Gate Wallet" onerror="this.style.display='none'; this.parentElement.innerHTML='G';" />
                    </div>
                    <div class="wallet-name">Gate Wallet</div>
                </div>
            </div>
            <div style="margin-top: 15px; text-align: center;">
                <button onclick="connectGenericWallet()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; padding: 12px 20px; font-size: 14px; cursor: pointer; transition: all 0.3s;">
                    üîó Try Generic Connection
                </button>
                <div style="font-size: 11px; color: #666; margin-top: 5px;">
                    If specific wallet doesn't work
                </div>
            </div>
            <button class="close-wallets" onclick="hideWalletSelector()">Cancel</button>
        </div>

        <div class="network-info">
            <div style="margin-bottom: 8px;">Connected to GateChain EVM (Chain ID: 86)</div>
            <div>Contract: <span id="contractAddress" style="font-family: monospace; font-size: 0.9em;">0xc53159571f3ec44029537ebd7d1afad29dba7b67</span></div>
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="successMessage" class="success" style="display: none;"></div>
    </div>

    <script>
        // Contract configuration
        const CONTRACT_ADDRESS = "0xc53159571f3ec44029537ebd7d1afad29dba7b67";
        const GATECHAIN_CONFIG = {
            chainId: '0x56',
            chainName: 'GateChain EVM',
            nativeCurrency: { name: 'GT', symbol: 'GT', decimals: 18 },
            rpcUrls: ['https://evm.gatenode.cc'],
            blockExplorerUrls: ['https://www.gatescan.org']
        };

        // Global variables
        let provider, signer, contract;
        let isConnected = false;
        let swapDirection = 'buy'; // 'buy' means buying GDOG314 with GT, 'sell' means selling GDOG314 for GT
        let currentWallet = null;
        let poolData = { gtBalance: 0, gdogBalance: 0, gdogPrice: 0 };
        let userBalances = { gt: 0, gdog: 0 };

        const GAS_LIMIT = 501211;
        const GAS_PRICE = "100000000000";
        let GT_PRICE_USD = 16.93; // ÈªòËÆ§‰ª∑Ê†ºÔºå‰ºöË¢´APIÊõ¥Êñ∞

        const CONTRACT_ABI = [
            "function getReserves() view returns (uint256, uint256)",
            "function balanceOf(address account) view returns (uint256)",
            "function transfer(address to, uint256 value) returns (bool)"
        ];

        // GT‰ª∑Ê†ºËé∑ÂèñAPIÈÖçÁΩÆ
        const PRICE_APIS = [
            {
                name: 'CoinGecko',
                url: 'https://api.coingecko.com/api/v3/simple/price?ids=gatechain-token&vs_currencies=usd',
                parser: (data) => data['gatechain-token']?.usd
            },
            {
                name: 'Gate.io API',
                url: 'https://api.gateio.ws/api/v4/spot/tickers?currency_pair=GT_USDT',
                parser: (data) => data[0]?.last ? parseFloat(data[0].last) : null
            }
        ];

        // Ëé∑ÂèñGT‰ª∑Ê†ºÁöÑÂáΩÊï∞
        async function fetchGTPrice() {
            for (const api of PRICE_APIS) {
                try {
                    const response = await fetch(api.url);
                    if (!response.ok) continue;
                    
                    const data = await response.json();
                    const price = api.parser(data);
                    
                    if (price && price > 0) {
                        GT_PRICE_USD = parseFloat(price);
                        document.getElementById('currentGtPrice').textContent = `$${GT_PRICE_USD.toFixed(2)}`;
                        await updatePoolData();
                        return GT_PRICE_USD;
                    }
                } catch (error) {
                    continue;
                }
            }
            return GT_PRICE_USD;
        }

        // ÂÆöÊúüÊõ¥Êñ∞‰ª∑Ê†º
        async function startPriceUpdate() {
            await fetchGTPrice();
            setInterval(async () => {
                await fetchGTPrice();
            }, 5 * 60 * 1000);
        }


        const WALLETS = {
            metamask: { 
                name: 'MetaMask', 
                provider: () => {
                    // ÊâÄÊúâÈí±ÂåÖÈÉΩ‰ΩøÁî® inject Ê≥®ÂÖ•ÊñπÂºè
                    if (window.ethereum) {
                        return window.ethereum;
                    }
                    return null;
                }
            },
            okx: { 
                name: 'OKX Wallet', 
                provider: () => {
                    // ÊâÄÊúâÈí±ÂåÖÈÉΩ‰ΩøÁî® inject Ê≥®ÂÖ•ÊñπÂºè
                    if (window.ethereum) {
                        return window.ethereum;
                    }
                    return null;
                }
            },
            tokenpocket: { 
                name: 'TokenPocket', 
                provider: () => {
                    // ÊâÄÊúâÈí±ÂåÖÈÉΩ‰ΩøÁî® inject Ê≥®ÂÖ•ÊñπÂºè
                    if (window.ethereum) {
                        return window.ethereum;
                    }
                    return null;
                }
            },
            gate: { 
                name: 'Gate Wallet', 
                provider: () => {
                    // Gate Wallet ÁâπÊÆäÊ£ÄÊµã
                    if (window.gatewallet) {
                        return window.gatewallet;
                    }
                    if (window.ethereum && window.ethereum.isGateWallet) {
                        return window.ethereum;
                    }
                    if (window.ethereum && window.ethereum.providers) {
                        const gateProvider = window.ethereum.providers.find(p => p.isGateWallet);
                        if (gateProvider) return gateProvider;
                    }
                    // ÊúÄÂêéÂ∞ùËØïÈÄöÁî®Ê≥®ÂÖ•
                    if (window.ethereum) {
                        return window.ethereum;
                    }
                    return null;
                }
            }
        };

        // Èí±ÂåÖÊ£ÄÊµãË∞ÉËØïÂáΩÊï∞
        function debugWalletDetection() {
            console.log('=== Wallet Detection Debug ===');
            console.log('window.ethereum:', window.ethereum);
            console.log('window.gatewallet:', window.gatewallet);
            console.log('window.tokenpocket:', window.tokenpocket);
            console.log('window.okxwallet:', window.okxwallet);
            
            if (window.ethereum) {
                console.log('ethereum.isMetaMask:', window.ethereum.isMetaMask);
                console.log('ethereum.isTokenPocket:', window.ethereum.isTokenPocket);
                console.log('ethereum.isGateWallet:', window.ethereum.isGateWallet);
                console.log('ethereum.isOkxWallet:', window.ethereum.isOkxWallet);
                console.log('ethereum.providers:', window.ethereum.providers);
            }
            console.log('==============================');
        }

        // Pool monitoring function
        async function updatePoolData() {
            try {
                if (!provider) {
                    provider = new ethers.JsonRpcProvider('https://evm.gatenode.cc');
                }
                
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, provider);
                const reserves = await contract.getReserves();
                const gtBalance = parseFloat(ethers.formatEther(reserves[0]));
                const gdogBalance = parseFloat(ethers.formatEther(reserves[1]));
                
                poolData.gtBalance = gtBalance;
                poolData.gdogBalance = gdogBalance;
                
                if (gtBalance > 0 && gdogBalance > 0) {
                    poolData.gdogPrice = (gtBalance / gdogBalance) * GT_PRICE_USD;
                }
                
                document.getElementById('poolGtBalance').textContent = gtBalance.toFixed(4) + ' GT';
                document.getElementById('poolGdogBalance').textContent = gdogBalance.toFixed(2) + ' GDOG314';
                document.getElementById('currentGdogPrice').textContent = '$' + poolData.gdogPrice.toFixed(6);
            } catch (error) {
                console.error('Error updating pool data:', error);
                document.getElementById('poolGtBalance').textContent = 'Error';
                document.getElementById('poolGdogBalance').textContent = 'Error';
            }
        }

        // Update swap direction indicator
        function updateSwapIndicator() {
            const indicator = document.getElementById('swapIndicator');
            const text = document.getElementById('swapDirectionText');
            
            if (swapDirection === 'buy') {
                indicator.className = 'swap-direction-indicator buy-indicator';
                text.textContent = 'üü¢ Buy GDOG314 with GT';
            } else {
                indicator.className = 'swap-direction-indicator sell-indicator';
                text.textContent = 'üü° Sell GDOG314 for GT';
            }
        }

        // Set percentage of balance
        function setPercentage(percentage) {
            if (!isConnected) {
                showError('Please connect your wallet first');
                return;
            }

            let balance;
            if (swapDirection === 'buy') {
                balance = userBalances.gt;
            } else {
                balance = userBalances.gdog;
            }

            const amount = (balance * percentage / 100).toFixed(6);
            document.getElementById('fromAmount').value = amount;
            calculateOutput();
        }

        // Wallet functions
        function showWalletSelector() {
            document.getElementById('walletSelector').classList.add('show');
            document.getElementById('connectBtn').style.display = 'none';
        }

        function hideWalletSelector() {
            document.getElementById('walletSelector').classList.remove('show');
            document.getElementById('connectBtn').style.display = 'block';
        }

        async function connectSpecificWallet(walletType) {
            const wallet = WALLETS[walletType];
            if (!wallet) {
                showError('Unsupported wallet type');
                return;
            }

            // Ë∞ÉËØïÈí±ÂåÖÊ£ÄÊµã
            debugWalletDetection();

            const walletProvider = wallet.provider();
            console.log(`${wallet.name} provider:`, walletProvider);
            
            if (!walletProvider) {
                // Êèê‰æõÊõ¥ËØ¶ÁªÜÁöÑÈîôËØØ‰ø°ÊÅØ
                let errorMsg = `${wallet.name} is not detected. `;
                if (walletType === 'gate') {
                    errorMsg += 'Please make sure Gate Wallet is installed and unlocked. Try refreshing the page.';
                } else {
                    errorMsg += 'Please install and unlock the wallet first.';
                }
                showError(errorMsg);
                return;
            }

            try {
                showLoading('connectBtn', `Connecting to ${wallet.name}...`);
                hideWalletSelector();
                
                await walletProvider.request({ method: 'eth_requestAccounts' });
                
                try {
                    await walletProvider.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: GATECHAIN_CONFIG.chainId }]
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await walletProvider.request({
                            method: 'wallet_addEthereumChain',
                            params: [GATECHAIN_CONFIG]
                        });
                    }
                }

                provider = new ethers.BrowserProvider(walletProvider);
                signer = await provider.getSigner();
                currentWallet = walletType;
                
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('swapBtn').style.display = 'block';
                
                isConnected = true;
                await updateBalances();
                showSuccess(`${wallet.name} connected successfully!`);
                
            } catch (error) {
                showError(`Failed to connect: ${error.message}`);
                showWalletSelector();
            } finally {
                hideLoading('connectBtn', 'Connect Wallet');
            }
        }

        async function updateBalances() {
            if (!isConnected) return;
            
            try {
                const address = await signer.getAddress();
                
                // Get GT balance
                const gtBalance = await provider.getBalance(address);
                userBalances.gt = parseFloat(ethers.formatEther(gtBalance));
                
                // Get GDOG balance
                try {
                    const gdogBalance = await contract.balanceOf(address);
                    userBalances.gdog = parseFloat(ethers.formatEther(gdogBalance));
                } catch (e) {
                    userBalances.gdog = 0;
                }
                
                // Update display based on current swap direction
                updateBalanceDisplay();
                
            } catch (error) {
                console.error('Error updating balances:', error);
            }
        }

        function updateBalanceDisplay() {
            if (swapDirection === 'buy') {
                document.getElementById('fromBalance').textContent = userBalances.gt.toFixed(4);
                document.getElementById('toBalance').textContent = userBalances.gdog.toFixed(2);
            } else {
                document.getElementById('fromBalance').textContent = userBalances.gdog.toFixed(2);
                document.getElementById('toBalance').textContent = userBalances.gt.toFixed(4);
            }
        }

        async function calculateOutput() {
            const fromAmount = document.getElementById('fromAmount').value;
            
            if (!fromAmount || fromAmount <= 0) {
                document.getElementById('toAmount').value = '';
                document.getElementById('priceInfo').style.display = 'none';
                document.getElementById('swapBtn').disabled = true;
                document.getElementById('swapBtn').textContent = 'Enter Amount';
                return;
            }

            try {
                let outputAmount;
                
                if (swapDirection === 'buy') {
                    const gtAmount = parseFloat(fromAmount);
                    const ethReserve = poolData.gtBalance || 100;
                    const tokenReserve = poolData.gdogBalance || 20000000;
                    
                    outputAmount = (gtAmount * tokenReserve) / (ethReserve + gtAmount);
                } else {
                    const gdogAmount = parseFloat(fromAmount);
                    const tokenReserve = poolData.gdogBalance || 20000000;
                    const ethReserve = poolData.gtBalance || 100;
                    
                    outputAmount = (gdogAmount * ethReserve) / (tokenReserve + gdogAmount);
                }

                outputAmount = outputAmount * 0.995; // 0.5% slippage
                
                document.getElementById('toAmount').value = outputAmount.toFixed(6);
                
                let expectedPrice;
                if (swapDirection === 'buy') {
                    expectedPrice = (parseFloat(fromAmount) * GT_PRICE_USD) / outputAmount;
                } else {
                    expectedPrice = (outputAmount * GT_PRICE_USD) / parseFloat(fromAmount);
                }
                
                document.getElementById('tokenPrice').textContent = `${expectedPrice.toFixed(6)}`;
                document.getElementById('receiveAmount').textContent = `${outputAmount.toFixed(6)} ${swapDirection === 'buy' ? 'GDOG314' : 'GT'}`;
                document.getElementById('priceInfo').style.display = 'block';
                
                document.getElementById('swapBtn').disabled = false;
                document.getElementById('swapBtn').textContent = swapDirection === 'buy' ? 'Buy GDOG314' : 'Sell GDOG314';
                
            } catch (error) {
                console.error('Error calculating output:', error);
                showError('Error calculating swap amount');
            }
        }

        function swapTokens() {
            swapDirection = swapDirection === 'buy' ? 'sell' : 'buy';
            
            // Clear input amounts
            document.getElementById('fromAmount').value = '';
            document.getElementById('toAmount').value = '';
            document.getElementById('priceInfo').style.display = 'none';
            
            // Update indicator
            updateSwapIndicator();
            
            // Swap token displays
            const fromTokenSelect = document.getElementById('fromTokenSelect');
            const toTokenSelect = document.getElementById('toTokenSelect');
            
            if (swapDirection === 'buy') {
                fromTokenSelect.innerHTML = '<div class="token-icon gt-icon"><img src="./gt-logo.png" alt="GT" onerror="this.style.display=\'none\'; this.parentElement.innerHTML=\'GT\';" /></div><span>GT</span>';
                toTokenSelect.innerHTML = '<div class="token-icon gdog-icon"><img src="./dog.png" alt="GDOG314" onerror="this.style.display=\'none\'; this.parentElement.innerHTML=\'GDOG\';" /></div><span>GDOG314</span>';
            } else {
                fromTokenSelect.innerHTML = '<div class="token-icon gdog-icon"><img src="./dog.png" alt="GDOG314" onerror="this.style.display=\'none\'; this.parentElement.innerHTML=\'GDOG\';" /></div><span>GDOG314</span>';
                toTokenSelect.innerHTML = '<div class="token-icon gt-icon"><img src="./gt-logo.png" alt="GT" onerror="this.style.display=\'none\'; this.parentElement.innerHTML=\'GT\';" /></div><span>GT</span>';
            }
            
            // Update balance displays
            updateBalanceDisplay();
            
            // Reset button
            document.getElementById('swapBtn').disabled = true;
            document.getElementById('swapBtn').textContent = 'Enter Amount';
        }

        async function executeSwap() {
            if (!isConnected) {
                showError('Please connect your wallet first');
                return;
            }

            const fromAmount = document.getElementById('fromAmount').value;
            if (!fromAmount || fromAmount <= 0) {
                showError('Please enter a valid amount');
                return;
            }

            try {
                showLoading('swapBtn', 'Swapping...');
                
                if (swapDirection === 'buy') {
                    const tx = await signer.sendTransaction({
                        to: CONTRACT_ADDRESS,
                        value: ethers.parseEther(fromAmount),
                        gasLimit: GAS_LIMIT,
                        gasPrice: GAS_PRICE
                    });
                    
                    await tx.wait();
                    showSuccess(`Successfully bought GDOG314! TX: ${tx.hash.substring(0,10)}...`);
                } else {
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    const tx = await contract.transfer(CONTRACT_ADDRESS, ethers.parseEther(fromAmount), {
                        gasLimit: GAS_LIMIT,
                        gasPrice: GAS_PRICE
                    });
                    
                    await tx.wait();
                    showSuccess(`Successfully sold GDOG314! TX: ${tx.hash.substring(0,10)}...`);
                }
                
                document.getElementById('fromAmount').value = '';
                document.getElementById('toAmount').value = '';
                document.getElementById('priceInfo').style.display = 'none';
                await updateBalances();
                await updatePoolData();
                
            } catch (error) {
                showError('Swap failed: ' + error.message);
            } finally {
                hideLoading('swapBtn', swapDirection === 'buy' ? 'Buy GDOG314' : 'Sell GDOG314');
            }
        }

        function showLoading(elementId, text) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<span class="loading"></span>${text}`;
            element.disabled = true;
        }

        function hideLoading(elementId, originalText) {
            const element = document.getElementById(elementId);
            element.innerHTML = originalText;
            element.disabled = false;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            setTimeout(() => successDiv.style.display = 'none', 5000);
        }

        function disconnectWallet() {
            isConnected = false;
            currentWallet = null;
            provider = null;
            signer = null;
            
            document.getElementById('connectBtn').style.display = 'block';
            document.getElementById('swapBtn').style.display = 'none';
            document.getElementById('connectBtn').innerHTML = 'Connect Wallet';
            document.getElementById('connectBtn').onclick = () => showWalletSelector();
            
            userBalances = { gt: 0, gdog: 0 };
            updateBalanceDisplay();
            
            showSuccess('Wallet disconnected');
        }

        // ÈÄöÁî®Èí±ÂåÖËøûÊé•ÊñπÊ≥ïÔºàÂ§áÁî®ÊñπÊ°àÔºâ
        async function connectGenericWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    showLoading('connectBtn', 'Connecting to wallet...');
                    hideWalletSelector();
                    
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    if (!accounts || accounts.length === 0) {
                        throw new Error('No accounts found');
                    }
                    
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: GATECHAIN_CONFIG.chainId }]
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [GATECHAIN_CONFIG]
                            });
                        }
                    }

                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    currentWallet = 'generic';
                    
                    document.getElementById('connectBtn').style.display = 'none';
                    document.getElementById('swapBtn').style.display = 'block';
                    
                    isConnected = true;
                    await updateBalances();
                    showSuccess('Wallet connected successfully!');
                    
                } catch (error) {
                    showError(`Failed to connect: ${error.message}`);
                    showWalletSelector();
                } finally {
                    hideLoading('connectBtn', 'Connect Wallet');
                }
            } else {
                showError('No wallet detected. Please install a Web3 wallet first.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateSwapIndicator();
            updatePoolData();
            setInterval(updatePoolData, 30000);
            
            // ÂêØÂä®‰ª∑Ê†ºÊõ¥Êñ∞
            startPriceUpdate();
            
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.on('accountsChanged', function(accounts) {
                    if (accounts.length === 0) {
                        disconnectWallet();
                    } else if (isConnected) {
                        updateBalances();
                    }
                });

                window.ethereum.on('chainChanged', function(chainId) {
                    if (chainId !== GATECHAIN_CONFIG.chainId && isConnected) {
                        showError('Please switch back to GateChain EVM network');
                    }
                });
            }
        });
    </script>
</body>
</html>
